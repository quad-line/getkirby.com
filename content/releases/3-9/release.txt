title: Kirby 3.9
----
Subtitle: Nadzikambia
----
Version: 3.9
----
ogimage: opengraph.png
----
Link: https://github.com/getkirby/kirby/releases/tag/3.9.0
----
Features:

- Snippets with slots
- Structure field improvements
- PHP 8.2 support[#4890](https://github.com/getkirby/kirby/pull/4890)

----
Enhancements:

- `Image\Image` uses its model's `alt` content field as fallback for rendering the `alt` attribute to better provide accessible defaults (we already did it for direct image objects, but now it also works for thumbs etc.) [#4915](https://github.com/getkirby/kirby/pull/4915)
- Pages section: the status flag button’s tooltip now includes the non-customised label of the current status for better accessibility [#4928](https://github.com/getkirby/kirby/pull/4928)
- The register dialog now displays an info field for which domain the license will be registered, including a warning when registering a local domain [#4930](https://github.com/getkirby/kirby/pull/4930)
- `Dimensions::forSvg()` supports percentages and better viewport fallbacks [#4921](https://github.com/getkirby/kirby/pull/4921)
- `Xml::attr()` and `Html::attr()` accept non-associative values (e.g. `Xml::attr(['attrA'])`), which get rendered like passing `true` (e.g. `attrA="attrA"`/`attrA`) [#4935](https://github.com/getkirby/kirby/pull/4935)
- The `Dir::copy()` method now supports `false` as the argument for `$ignore`. In this mode, all files are copied, including those listed in the global `Dir::$ignore` list. [#4872](https://github.com/getkirby/kirby/pull/4872)
- Sensitive information like passwords is redacted in logs when using PHP 8.2+ [#4945](https://github.com/getkirby/kirby/pull/4945)

----
Fixes:

- Kirby queries: optional chaining on non-null values works now properly [#4901](https://github.com/getkirby/kirby/pull/4901)
- Panel: load development icons file when in dev mode [#4900](https://github.com/getkirby/kirby/pull/4900)
- Files field: for `store: id` only the name is stored again when the current model is the file's parent [#4870](https://github.com/getkirby/kirby/issues/4870)
- Fixes prepending redundant `mailto:` in `k-link` [#4882](https://github.com/getkirby/kirby/pull/4882)
- `Toolkit\Xml::attr()` is case-sensitive now [#4911](https://github.com/getkirby/kirby/pull/4911)
- Fixed focus for checkboxes and radio input with no options [#4917](https://github.com/getkirby/kirby/pull/4917)
- Now treating paths with trailing dot as non-existing content representation [#4920](https://github.com/getkirby/kirby/pull/4920)
- Fixed console errors for failed `lock`  request when deleting page with unsaved changes [#4919](https://github.com/getkirby/kirby/pull/4919)
- Fixed error message for missing field type [#4929](https://github.com/getkirby/kirby/pull/4929)
- `->words()` field method works as expected on `null` values [#4905](https://github.com/getkirby/kirby/pull/4905)
- Writer: links now fully wrap inline styling instead of generating multiple link parts [#4866](https://github.com/getkirby/kirby/issues/4866)
- Fixed false-positive blocked requests by ModSecurity (OWASP rules) [#4933](https://github.com/getkirby/kirby/pull/4933)
- I18n - English translation had `February` set to `Feburary` [#4903](https://github.com/getkirby/kirby/pull/4903)

----
Breaking:

- `$kirby->impersonate()` doesn't bind the app instance to the `$callback` closure anymore [#4944](https://github.com/getkirby/kirby/pull/4944)
- The `snippet` core component receives an additional parameter `bool $slots` and returns `Kirby\Template\Snippet|string` [#4910](https://github.com/getkirby/kirby/pull/4910)
- `$kirby->snippet()` and the `snippet()` helper return `Kirby\Template\Snippet|string|null` [#4910](https://github.com/getkirby/kirby/pull/4910)
- `Html::rel()` now consistently returns `null` instead of an empty string when no `rel` attribute is needed [#4948](https://github.com/getkirby/kirby/pull/4948)

**Removed deprecated code**

- Deprecated method `Kirby\Cms\App::server()` has been removed. Use `App::environment()` instead. [#4944](https://github.com/getkirby/kirby/pull/4944)

----
Refactoring:

- Improvements for `Toolkit\Locale` code quality [#4926](https://github.com/getkirby/kirby/pull/4926)
- Improvements for `Toolkit\Escape` code quality [#4925](https://github.com/getkirby/kirby/pull/4925)
- Improvements for `Toolkit\Obj` code quality [#4923](https://github.com/getkirby/kirby/pull/4923)
- Improvements for `Toolkit\A` code quality [#4942](https://github.com/getkirby/kirby/pull/4942)
- Improvements for `Toolkit\I18n` code quality [#4939](https://github.com/getkirby/kirby/pull/4939)
- Improvements for `Toolkit\Silo` code quality [#4922](https://github.com/getkirby/kirby/pull/4922)
- Improvements for `Toolkit\Controller` code quality [#4937](https://github.com/getkirby/kirby/pull/4937)
- Improvements for `Toolkit\Iterator` code quality [#4938](https://github.com/getkirby/kirby/pull/4938)
- Upgraded to Vite 4 and some other JS dependencies [#4912](https://github.com/getkirby/kirby/pull/4912)
- Updated composer dependencies [#4946](https://github.com/getkirby/kirby/pull/4946)
- PHP 8.2 prep: Fix dynamic properties in search component [#4888](https://github.com/getkirby/kirby/pull/4888)
- PHP 8.2 prep: Parsedown - fix `mb_convert_encoding` deprecation [#4887](https://github.com/getkirby/kirby/pull/4887)
- The `Kirby\Cms\Template` class moved to `Kirby\Template\Template`. An alias has been added. [#4910](https://github.com/getkirby/kirby/pull/4910)
- Our unit tests now always trigger our own deprecation warnings, which allows us to find uses of deprecated code in our own code.

----
Deprecated:

- The `.k-offscreen` CSS class has been deprecated. Use `.sr-only` instead [#4944](https://github.com/getkirby/kirby/pull/4944)
- The `Toolkit\Query` class has been deprecated and will be removed in a future version. Use `Query\Query` instead [#4944](https://github.com/getkirby/kirby/pull/4944)
- Passing an empty string as value to `Xml::attr()` / `Html::attr()` has been deprecated and will throw a warning. In a future version, passing an empty string won't omit the attribute anymore but render it with an empty value. To omit the attribute, please pass `null` [#4934](https://github.com/getkirby/kirby/pull/4934)

----

SnippetsA:

```php "/site/template/article.php"
<?php snippet('article', slots: true) ?>
  <?php slot('header') ?>
    <h1>This is the title</h1>
  <?php endslot() ?>

  <?php slot('body') ?>
    <p>This is some body text</p>
  <?php endslot() ?>
<?php endsnippet() ?>
```

----

SnippetsB:

```php "/site/snippets/article.php"
<article>
  <?php if ($header = $slots->header()): ?>
  <header>
    <?= $header ?>
  </header>
  <?php endif ?>

  <?= $slots->body() ?>
</article>
```

----

CLI:

```php
Kirby::plugin('your/plugin', [
  'commands' => [
    'your-plugin:test' => [
      'description' => 'Nice command',
      'args' => [],
      'command' => function ($cli) {
        $cli->success('My first plugin command');
      }
    ]
  ]
]);
```

----

CLICommand:

```bash
$ kirby your-plugin:test
# My first plugin command
```

----

Eleventy:

The Eleventykit is a very simple (unstyled) example for a site, built with [Kirby](https://getkirby.com) and [11ty](https://11ty.dev).

[Kirby’s query language (KQL)](https://github.com/getkirby/kql) is used to fetch articles from our KQL playground: https://kql.getkirby.com

Use your own Kirby installation with the KQL plugin to provide a powerful headless CMS for your static 11ty site.

----

EleventyExample:

```js "11ty: /_data/posts.js"
const { $fetch } = require("ofetch");

module.exports = async function () {

    const api = "https://kql.getkirby.com/api/query";

    const response = await $fetch(api, {
        method: "post",
        body: {
            query: "page('notes').children.sortBy('date', 'desc')",
            select: {
                title: true,
                text: "page.text.toBlocks.toHtml",
                slug: true,
                date: "page.date.toDate('d.m.Y')"
            }
        }
    });

    return response.result;

}
```
